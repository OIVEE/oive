<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="resource.ViewMapper">
	<!-- <select id="selectAll" parameterType="String" resultType="vo.SelfIntroduceVO">
		select * from Self_Introduce 
		where userid = #{userid}
	</select> -->
	
<select id="viewByCompany" parameterType="hashmap" resultType="vo.SelfIntroduceVO">
select *
		    from(
		    select rownum rnum, t.* from(
		        select s.id, to_char(s.applydate,'yyyy-mm-dd') applydate,
		            to_char(s.editdate,'yyyy-mm-dd') editdate, s.appliedcompany, k.keywords
		        from self_introduce s left outer join (select s.id, listagg(k.keyword,',') within group(order by sid) as keywords
		                from keyword_selfintroduce k, self_introduce s
		                where sid = s.id and s.userid = #{userId}
		                group by s.id) k
		            on s.id = k.id
		        order by s.id desc) t)
		where rnum between 1 and 10

</select>
<select id="viewByQuestion" parameterType="hashmap" resultType="vo.SelfIntroduceVO">
	select k.keywords, to_char(s.applydate,'yyyy-mm-dd') writedate, s.appliedcompany
	from self_introduce s, (select listagg(k.keyword,',') within group(order by sid) as keywords
	from keyword_selfintroduce k, self_introduce s
	where sid = s.id and s.userid = #{userId} and s.question like '%'||#{input}||'%'
	group by s.id) k
</select>
<select id="viewByAnswer" parameterType="hashmap" resultType="vo.SelfIntroduceVO">
	select k.keywords, to_char(s.applydate,'yyyy-mm-dd') writedate, s.appliedcompany
	from self_introduce s, (select listagg(k.keyword,',') within group(order by sid) as keywords
	from keyword_selfintroduce k, self_introduce s
	where sid = s.id and s.userid = #{userId} and s.answer like '%'||#{input}||'%'
	group by s.id) k
</select>
<select id="viewByKeyword" parameterType="hashmap" resultType="vo.SelfIntroduceVO">
	select k.keywords, to_char(s.applydate,'yyyy-mm-dd') writedate, s.appliedcompany
	from self_introduce s, (select listagg(k.keyword,',') within group(order by sid) as keywords
	from keyword_selfintroduce k, self_introduce s
	where sid = s.id and s.userid = #{userId} and s.keyword like '%'||#{input}||'%'
	group by s.id) k
</select>		
</mapper>






	

